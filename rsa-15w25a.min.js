// Copyright 2005-2009 Tom Wu. All rights reserved.
// Licensed under MIT Licence.

(function(h){var n,k,l,d,m,p,q;d=function(a){return 16>a?"0"+a.toString(16):a.toString(16)};p=function(a){var c,b,f;b="";for(f=0;f<a.length;)c=a.codePointAt(f),128>c?b+=d(c):2048>c?b+=d(c>>6|176)+d(c%64|128):65536>c?(b+=d(c>>12|224),b+=d((c>>6)%64|128),b+=d(c%64|128)):2097152>c?(b+=d(c>>18|240),b+=d((c>>12)%64|128),b+=d((c>>6)%64|128),b+=d(c%64|128)):b+="ee8080",f++;return b};q=function(a){var c,b,f,g,e,d;d="";for(e=0;e<a.length;)c=parseInt(a.substr(e,2),16),d+=String.fromCodePoint(128>c?c:224>c?
(b=parseInt(a.substr(e+=2,2),16),((c^176)<<6)+(b^128)):240>c?(b=parseInt(a.substr(e+=2,2),16),f=parseInt(a.substr(e+=2,2),16),((c^224)<<12)+((b^128)<<6)+(f^128)):248>c?(b=parseInt(a.substr(e+=2,2),16),f=parseInt(a.substr(e+=2,2),16),g=parseInt(a.substr(e+=2,2),16),((c^240)<<18)+((b^128)<<12)+((f^128)<<6)+(g^128)):57344),e+=2;return d};m=function(a,c){var b,f;b=0;for(f=[];b<a.length;)f.push(a.slice(b,b+=c));return f};n=function(){function a(c,b,a,d){b>>=1;for(this.e=new BigInteger(a.toString(16),16);;){for(;this.p=
new BigInteger(b,1,c),0!==this.p.subtract(BigInteger.ONE).gcd(this.e).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(b,1,c),0!==this.q.subtract(BigInteger.ONE).gcd(this.e).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););a=this.p.subtract(BigInteger.ONE).multiply(this.q.subtract(BigInteger.ONE));if(0===a.gcd(this.e).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q);this.d=this.e.modInverse(a);break}}this.owner=null!=d?d:null}a.prototype.p=null;
a.prototype.q=null;a.prototype.n=null;a.prototype.e=0;a.prototype.d=null;a.prototype.owner="";a.prototype.getPublic=function(){return new l(this.n,this.e,this.owner)};a.prototype.getPrivate=function(){return new k(this.n,this.d,this.owner)};return a}();l=function(){function a(c,b,a){this.n="string"===typeof c?new BigInteger(c,16):c;this.e="string"===typeof b?new BigInteger(b,16):b;this.owner=null!=a?a:null}a.prototype.n=null;a.prototype.e=0;a.prototype.owner="";a.prototype.encrypt=function(c){var b,
a,d,e;b=new BigInteger(c,16);if(1>b.compareTo(this.n))return b.modPow(this.e,this.n).toString(16);d=m(c,.75*this.n.bitLength()/4);e=[];b=0;for(a=d.length;b<a;b++)c=d[b],e.push(this.encrypt(c));return e};a.prototype.decrypt=function(c){var b;if("string"===typeof c)return encrypt(c);var a,d,e;e=[];a=0;for(d=c.length;a<d;a++)b=c[a],e.push(this.encrypt(b));return e.join()};return a}();k=function(){function a(c,b,a){this.n="string"===typeof c?new BigInteger(c,16):c;this.d="string"===typeof b?new BigInteger(b,
16):b;this.owner=null!=a?a:null}a.prototype.n=null;a.prototype.d=null;a.prototype.owner="";a.prototype.decrypt=function(a){var b,d,g,e;if("string"===typeof a){b=new BigInteger(a,16);if(1>b.compareTo(this.n))return b.modPow(this.d,this.n).toString(16);g=m(a,.75*this.n.bitLength()/4);e=[];a=0;for(d=g.length;a<d;a++)b=g[a],e.push(this.decrypt(b));return e}e=[];d=0;for(g=a.length;d<g;d++)b=a[d],e.push(this.decrypt(b));return e.join("")};a.prototype.sign=function(a){return decrypt(a)};return a}();"undefined"!==
typeof module&&null!==module&&(module.exports={RSAKey:n,RSAPublicKey:l,RSAPrivateKey:k,byte2hex:d,hexify:p,unhexify:q});h.RSAKey=n;h.RSAPublicKey=l;h.RSAPrivateKey=k;h.byte2hex=d;h.hexify=p;h.unhexify=q;h.divideString=m})(this);